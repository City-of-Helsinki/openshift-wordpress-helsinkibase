# Disable Directory Browsing
Options -Indexes

# Block WordPress xmlrpc.php requests
<Files xmlrpc.php>
  order deny,allow
  deny from all
</Files>

# Block file requests
<filesMatch ".(htaccess|htpasswd|ini|log|sh)$">
  order deny,allow
  deny from all
</filesMatch>

# Block User Enumeration
<IfModule mod_rewrite.c>
  RewriteCond %{QUERY_STRING} ^author=([0-9]*)
  RewriteRule .* https://%{HTTP_HOST}%{REQUEST_URI}/? [L,R=302]
</IfModule>

# BEGIN WordPress
<IfModule mod_rewrite.c>
  RewriteEngine On
  
  RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
  RewriteBase /

$PARSED_REDIRECTS

  # if WORDPRESS_REDIRECT_TO_PRIMARY_ROUTE is set to "True", redirect all to primary domain
  RewriteCond %{ENV:WORDPRESS_REDIRECT_TO_PRIMARY_ROUTE} ^true
  RewriteCond https://%{HTTP_HOST} !$WORDPRESS_SITE_URL [NC]
  RewriteRule ^(.*)$ %{ENV:WORDPRESS_SITE_URL}/$1 [L,R=302]
  
  # if WORDPRESS_SHOW_ERROR_PAGE is set to "True", show error page
  RewriteCond %{ENV:WORDPRESS_SHOW_ERROR_PAGE} ^true
  RewriteCond %{REQUEST_URI} !/wp-json/wp/v2/posts [NC]
  RewriteRule ^(.*)$ %{ENV:WORDPRESS_ERROR_PAGE_URL}/$1 [P,L]

  RewriteRule ^index\.php$ - [L]
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule . /index.php [L]
</IfModule>
# END
